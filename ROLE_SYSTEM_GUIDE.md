# 🎭 راهنمای سیستم نقش‌های کاربری

سیستم کامل مدیریت نقش‌های کاربری برای ربات P24_SlotHunter

## 📋 نقش‌های کاربری

### 🔒 مهمان (GUEST)
- **دسترسی محدود**
- مشاهده اطلاعات عمومی
- نیاز به تایید برای استفاده کامل

### 👤 کاربر عادی (USER)  
- **دسترسی کامل به امکانات کاربری**
- مشاهده دکترها
- اشتراک در دکترها
- دریافت اطلاعیه‌ها
- مدیریت اشتراک‌های شخصی

### 👮 مدیر (MODERATOR)
- **همه امکانات کاربر +**
- مدیریت دکترها
- مشاهده آمار سیستم
- مدیریت محتوا

### 👑 ادمین (ADMIN)
- **همه امکانات مدیر +**
- مدیریت کاربران
- تغییر تنظیمات سیستم
- دسترسی به پنل ادمین
- مدیریت کامل سیستم

### ⭐ سوپر ادمین (SUPER_ADMIN)
- **دسترسی کامل به همه چیز**
- مدیریت ادمین‌ها
- تنظیمات پیشرفته
- عملیا�� اضطراری

## 🔧 تنظیم نقش‌ها

### 1. تعیین سوپر ادمین
سوپر ادمین از طریق فایل `.env` تعیین می‌شود:

```env
# شناسه تلگرام سوپر ادمین
ADMIN_CHAT_ID=123456789
```

### 2. تعیین سایر نقش‌ها
سایر نقش‌ها از طریق دیتابیس و دستورات ادمین تعیین می‌شوند.

## 📱 منوهای مختلف

### منوی کاربر عادی:
```
👨‍⚕️ دکترها        📝 اشتراک‌ها
🔔 اشتراک جدید      🗑️ لغو اشتراک  
📊 وضعیت من        ℹ️ راهنما
⚙️ تنظیمات         📞 پشتیبانی
```

### منوی مدیر:
```
👨‍⚕️ دکترها        📝 اشتراک‌ها
🔔 اشتراک جدید      🗑️ لغو اشتراک
📊 وضعیت من        ℹ️ راهنما
⚙️ تنظیمات         📞 پشتیبانی
📈 آمار سیستم      👥 مدیریت کاربران
```

### منوی ادمین:
```
👨‍⚕️ دکترها        📝 اشتراک‌ها
🔔 اشتراک جدید      🗑️ لغو اشتراک
📊 وضعیت من        ℹ️ راهنما
⚙️ تنظیمات         📞 پشتیبانی
📈 آمار سیستم      👥 مدیریت کاربران
👑 پنل ا��مین        🔧 مدیریت سیستم
```

### منوی سوپر ادمین:
```
👨‍⚕️ دکترها        📝 اشتراک‌ها
🔔 اشتراک جدید      🗑️ لغو اشتراک
📊 وضعیت من        ℹ️ راهنما
⚙️ تنظیمات         📞 پشتیبانی
📈 آمار سیستم      👥 مدیریت کاربران
👑 پنل ادمین        🔧 مدیریت سیستم
⭐ سوپر ادمین       🛠️ تنظیمات پیشرفته
```

## 🔐 کنترل دسترسی

### حالت‌های دسترسی:
1. **باز (open)**: همه کاربران جدید به عنوان USER
2. **محدود (restricted)**: کاربران جدید نیاز به تایید
3. **فقط ادمین (admin_only)**: فقط ادمین‌ها دسترسی دارند

### تنظیم حالت دسترسی:
```env
ACCESS_MODE=open        # یا restricted یا admin_only
```

## 🛠️ API سیستم نقش‌ها

### بررسی نقش کاربر:
```python
from src.telegram_bot.user_roles import user_role_manager

# دریافت نقش کاربر
role = user_role_manager.get_user_role(user_id)

# بررسی دسترسی‌ها
is_admin = user_role_manager.is_admin_or_higher(user_id)
is_moderator = user_role_manager.is_moderator_or_higher(user_id)
is_user = user_role_manager.is_user_or_higher(user_id)
```

### تغییر نقش کاربر:
```python
# تنظیم نقش (فقط توسط ادمین)
success = user_role_manager.set_user_role(
    user_id=123456789,
    role=UserRole.ADMIN,
    by_admin_id=admin_user_id
)
```

## 📊 مجوزهای هر نقش

### 🔒 مهمان:
- مشاهده اطلاعات عمومی

### 👤 کاربر:
- مشاهده دکترها
- اشتراک در دکترها
- دریافت اطلاعیه‌ها
- مدیریت اشتراک‌های شخصی

### 👮 مدیر:
- همه مجوزهای کاربر
- مدیریت دکترها
- مشاهده آمار
- مدیریت محتوا

### 👑 ادمین:
- همه مجوزهای مدیر
- مدیریت کاربران
- تغییر تنظیمات
- دسترسی به پنل ادمین
- مدیریت سیستم

### ⭐ سوپر ادمین:
- همه مجوزها
- مدیریت ادمین‌ها
- تنظیمات پیشرفته
- دسترسی کامل سیستم

## 🔄 نحوه کار سیستم

### 1. شناسایی کاربر:
```python
# هنگام ورود کاربر
user_role = user_role_manager.get_user_role(user_id)

# نمایش منوی مناسب
keyboard = MenuHandlers.get_main_menu_keyboard(user_id)
```

### 2. کنترل دسترسی:
```python
# بررسی دسترسی قبل از اجرای عملیات
if not user_role_manager.is_admin_or_higher(user_id):
    await update.message.reply_text("❌ دسترسی ندارید")
    return
```

### 3. منوی پویا:
منوها بر اساس نقش کاربر به صورت خودکار تنظیم می‌شوند.

## 🚀 مزایای سیستم

### ✅ مزایا:
- **امنیت بالا**: کنترل دقیق دسترسی‌ها
- **انعطاف‌پذیری**: قابلیت اضافه کردن نقش‌های جدید
- **سادگی**: رابط کاربری ساده و قابل فهم
- **مقیاس‌پذیری**: قابل توسعه برای پروژه‌های بزرگ

### 🔧 قابلیت‌های آینده:
- نقش‌های سفارشی
- مجوزهای جزئی‌تر
- سیستم تیم‌ها
- مدیریت سازمانی

## 📝 نکات مهم

### ⚠️ نکات امنیتی:
1. سوپر ادمین نمی‌تواند تغییر کند
2. ادمین‌ها نمی‌توانند سوپر ادمین تغییر دهند
3. همه تغییرات لاگ می‌شوند

### 💡 بهترین روش‌ها:
1. حداقل دسترسی لازم را بدهید
2. مرتب نقش‌ها را بررسی کنید
3. از لاگ‌ها برای نظارت استفاده کنید

---

**🎯 سیستم نقش‌های P24_SlotHunter آماده ا��تفاده است!**